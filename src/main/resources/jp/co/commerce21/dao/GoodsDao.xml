<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="jp.co.commerce21.dao.GoodsDao">
    <select id="searchGoods" resultType="jp.co.commerce21.entity.Goods">
select 
	goods.goods_no, goods.goods_name, goods.goods_display, goods.goods_ability, 
	goods.goods_memory, goods.goods_storage, goods.goods_battery, attr.attributes, goods.stock_cnt
from
	(
    select
		tg.goods_no, goods_name, goods_display, goods_ability, goods_memory, goods_storage, goods_battery, ts.stock_cnt
	from
		tgoods as tg, tstock as ts
	where tg.goods_no = ts.goods_no
    ) as goods
left join 
	(
    select
		tag.goods_no, 
        group_concat(ta.attribute_value) as attributes
	from
		tattributegoods as tag  left join tattribute  as ta
	on 
		tag.attribute_id = ta.attribute_id
    group by 
		goods_no
	) as attr
on goods.goods_no = attr.goods_no;
    </select>
</mapper>